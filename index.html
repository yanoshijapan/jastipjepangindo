<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yanoshi Jastip - Jepang Indo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Palette Warna (Diambil dari IndoJp style namun disesuaikan dengan nuansa Yanoshi) */
            --primary: #17a2b8; /* Cyan-ish Blue dari JapanIndo original */
            --primary-dark: #117a8b;
            --accent: #0ea5e9;
            --success: #10b981; 
            --success-dark: #059669;
            --error: #ef4444;
            --warning: #ffc107;
            --surface: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.6);
            --text-main: #1e293b;
            --text-light: #64748b;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            color: var(--text-main);
            margin: 0; padding: 0; min-height: 100vh;
            /* Background Gradient ala IndoJp */
            background: radial-gradient(circle at 0% 0%, #d1e9ff 0%, transparent 50%), 
                        radial-gradient(circle at 100% 0%, #e0f7fa 0%, transparent 50%), 
                        radial-gradient(circle at 100% 100%, #d1e9ff 0%, transparent 50%), 
                        radial-gradient(circle at 0% 100%, #e0f7fa 0%, transparent 50%), #f8fafc;
            background-attachment: fixed;
        }

        /* --- POPUP SYARAT & KETENTUAN (Style IndoJp) --- */
        #consent-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(8px);
        }

        #consent-modal {
            background: #ffffff;
            width: 90%; max-width: 600px;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex; flex-direction: column;
            max-height: 85vh;
            animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #consent-modal h3 {
            color: var(--primary); text-align: center; margin: 0 0 15px 0;
            font-size: 1.4rem; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px;
        }

        #terms-text {
            flex: 1; overflow-y: auto;
            background: #f8fafc; padding: 15px;
            border: 1px solid #cbd5e1; border-radius: 12px;
            margin-bottom: 20px; font-size: 0.9rem; line-height: 1.6; color: #334155;
            scroll-behavior: smooth;
        }
        
        #terms-text img {
            max-width: 100%; height: auto; border-radius: 8px; 
            margin: 10px 0; border: 1px solid #e2e8f0;
        }

        .consent-controls { border-top: 1px solid #f1f5f9; padding-top: 15px; }
        
        .consent-controls label {
            display: flex; gap: 12px; align-items: flex-start;
            cursor: pointer; font-size: 0.9rem; color: var(--text-main); margin-bottom: 15px;
            padding: 10px; border-radius: 8px; transition: background 0.2s;
        }
        
        .consent-controls label:hover { background: #eff6ff; }

        #consent-checkbox { width: 20px; height: 20px; margin-top: 2px; accent-color: var(--primary); cursor: pointer; }
        #consent-checkbox:disabled { cursor: not-allowed; filter: grayscale(100%); opacity: 0.6; }
        #consent-checkbox:disabled + span { color: #94a3b8; }

        #agree-button {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            font-weight: 700; font-size: 1rem; background: var(--primary); color: white;
            cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        
        #agree-button:disabled {
            background: #cbd5e1; color: #64748b; cursor: not-allowed; box-shadow: none;
        }
        
        #agree-button:not(:disabled):hover {
            background: var(--primary-dark); transform: translateY(-2px);
        }

        /* --- GLASS CONTAINER (Main Form) --- */
        .glass-container {
            background: var(--surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            border-radius: var(--radius-lg);
            max-width: 700px;
            margin: 90px auto 40px;
            padding: 2.5rem;
            position: relative;
            overflow: hidden;
        }

        /* --- HEADER --- */
        .fixed-header {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            padding: 15px 5%; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-logo {
            font-weight: 800; font-size: 1.2rem; color: var(--primary);
            display: flex; align-items: center; gap: 10px;
        }
        .header-logo img { height: 35px; width: auto; } 
        
        .header-btn {
            background: var(--text-main); color: white; padding: 8px 20px;
            border-radius: 50px; text-decoration: none; font-size: 0.85rem; font-weight: 600;
            transition: transform 0.2s;
        }
        .header-btn:hover { transform: translateY(-2px); background: #0f172a; }
        
        h1 {
            text-align: center; font-weight: 800; font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem;
        }

        /* --- INPUTS --- */
        .input-group { margin-bottom: 1.5rem; position: relative; }
        label { display: block; font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--text-main); }
        .required::after { content: ' *'; color: var(--error); }
        
        input[type="text"], input[type="tel"], input[type="number"], textarea, select {
            width: 100%; padding: 16px; border: 2px solid #e2e8f0; border-radius: var(--radius-md);
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1rem;
            background: #fff; box-sizing: border-box; transition: all 0.3s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(23, 162, 184, 0.1);
        }
        
        .helper-text {
						/* Pastikan tulisan dianggap sebagai blok terpisah */
						display: block !important; 
						width: 100%;
						
						/* Beri jarak atas agar tidak nempel dengan tombol */
						margin-top: 10px !important; 
						
						/* Atur warna dan ukuran agar rapi */
						font-size: 0.8rem; 
						color: var(--text-light);
						line-height: 1.4;
				}
        .helper-text::before { content: '‚ÑπÔ∏è'; font-size: 0.9rem; }

        /* --- RADIO CARDS (Pilihan Kotak) --- */
        .radio-cards-container { 
						display: grid; 
						grid-template-columns: 1fr 1fr; 
						gap: 20px; 
						margin-bottom: 30px !important;
				}
        .radio-card { 
						cursor: pointer; 
						position: relative; 
				}
        .radio-card input { 
						position: absolute; 
						opacity: 0; 
				}
        .card-content {
            display: flex; 
						flex-direction: column; 
						align-items: center; 
						justify-content: center; 
						padding: 7px 5px;
            background: #fff; 
						border: 2px solid #e2e8f0; 
						border-radius: var(--radius-sm); 
						transition: all 0.3s;
            text-align: center; 
						height: 100%;
        }
        .card-content span { 
						font-weight: 600; 
						font-size: 0.85rem;
				}
        .radio-card input:checked + .card-content { 
						border-color: var(--primary); 
						background: #eff6ff; 
						color: var(--primary); 
				}
        
        /* --- CONDITIONAL FIELD ANIMATION --- */
        .conditional-field {
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease, opacity 0.4s ease;
            opacity: 0; margin-top: 0;
        }
        .conditional-field.show { max-height: 200px; opacity: 1; margin-top: 15px; }

        /* --- NAV & PROGRESS --- */
        .progress-track { background: #e2e8f0; height: 6px; border-radius: 10px; margin: 20px 0 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 0.5s; }
        .step-text { text-align: center; font-size: 0.85rem; color: var(--text-light); font-weight: 600; margin-bottom: 30px; letter-spacing: 1px; }

        .nav-buttons { display: flex; gap: 15px; margin-top: 30px; }
        .btn {
            flex: 1; padding: 16px; border: none; border-radius: var(--radius-sm);
            font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3); }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; box-shadow: none; }
        
        .btn-success { background: var(--success); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .btn-success:hover { background: var(--success-dark); box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4); }
        
        .btn-secondary { background: #f1f5f9; color: var(--text-main); }

        .form-step { display: none; animation: fadeInSlide 0.5s ease; }
        .form-step.active { display: block; }
        @keyframes fadeInSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- REVIEW & SUCCESS --- */
        .review-list { margin-top: 10px; }
        .review-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f5f9; }
        .review-item:last-child { border-bottom: none; }
        .review-label { color: var(--text-light); font-size: 0.9rem; }
        .review-value { font-weight: 600; text-align: right; max-width: 60%; word-break: break-word; }

        /* Fullscreen Loader */
        #circular-loader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); z-index: 5000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner {
            width: 60px; height: 60px; border: 5px solid #e2e8f0;
            border-top: 5px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { font-weight: 600; color: var(--primary); font-size: 1.1rem; }

        @media (max-width: 600px) {
            .glass-container { 
								padding: 1.5rem; 
								width: 90%; 
						}
            .nav-buttons { 
								flex-direction: column-reverse; 
						}
            .fixed-header { 
								padding: 15px 1rem; 
						}
            .radio-cards-container { 
								/* Paksa tetap 2 kolom (bersebelahan) */
								grid-template-columns: 1fr 1fr !important; 
								gap: 20px; /* Jarak antar kotak lebih rapat */
								margin-bottom: 30px !important;
						}
						.card-content {
								padding: 5px 4px !important; /* Padding sangat tipis */
								min-height: auto; /* Hilangkan tinggi minimum jika ada */
						}
						.card-content span {
								font-size: 0.75rem !important; /* Ukuran font lebih kecil (sekitar 12px) */
								line-height: 1.2; /* Jarak antar baris teks lebih rapat */
						}
        }
    </style>
</head>
<body>

<div id="consent-overlay">
    <div id="consent-modal">
        <h3>üìã Syarat & Ketentuan Jastip</h3>
        <div id="terms-text">
            <p><strong>‚ö†Ô∏è Harap baca dengan saksama dan scroll sampai habis sebelum melanjutkan:</strong></p>
            <ul>
                <li><strong>Barang Legal:</strong> Barang yang dikirim adalah barang legal dan tidak melanggar hukum di Indonesia maupun Jepang. Seperti obat-obatan terlarang, senjata api, senjata tajam, bahan peledak, barang yang mudah terbakar, barang palsu, uang palsu dan beberapa barang spesifik dibawah ini:</li>
                
                <div style="text-align: center; margin: 15px 0;">
                    <img src="https://yanoshijapan.github.io/asetonline/barangumum.jpg" alt="Barang Dilarang Umum" loading="lazy">
                    <img src="https://yanoshijapan.github.io/asetonline/barangspesifik.jpg" alt="Barang Dilarang Spesifik" loading="lazy">
                </div>

                <li><strong style="color: var(--error);">PENTING:</strong> Jika barang tersebut tetap dikirim ke basecamp kami, maka kami akan kembalikan barang tersebut ke pengirim.</li>
                <li><strong>Tanggung Jawab:</strong> Kami tidak bertanggung jawab atas kerusakan barang yang disebabkan oleh pihak ketiga (maskapai/kurir).</li>
                <li><strong>Keterlambatan:</strong> Keterlambatan pengiriman yang disebabkan oleh faktor di luar kendali kami (cuaca, delay pesawat, dll) akan diinformasikan sesegera mungkin.</li>
                <li><strong>Keakuratan Data:</strong> Dengan melanjutkan, Anda menyatakan bahwa semua informasi yang diberikan adalah benar dan akurat.</li>
                <li><strong>Pajak & Bea Cukai:</strong> Pajak bea cukai (jika ada) akan menjadi tanggung jawab penerima.</li>
                <li style="margin-bottom: 50px;"><strong>Silakan scroll sampai habis untuk membuka tombol setuju.</strong></li>
            </ul>
        </div>
        <div class="consent-controls">
            <label id="label-checkbox" title="Baca sampai bawah untuk membuka kunci">
                <input type="checkbox" id="consent-checkbox" disabled>
                <span>Saya telah membaca dan menyetujui semua syarat & ketentuan yang berlaku.</span>
            </label>
            <button id="agree-button" disabled>Setuju & Lanjutkan</button>
        </div>
    </div>
</div>

<header class="fixed-header">
    <div class="header-logo">
				<img src="https://yanoshijapan.github.io/jastip/jastip%202.png" alt="Yanoshi Logo">
    </div>
    <a href="https://yanoshijapan.github.io/jastipyanoshi/" class="header-btn">
        üè† Ke Website
    </a>
</header>

<main>
    <div class="glass-container">
        <h1>Yanoshi Jastip<br><span style="color: var(--primary); font-size: 1.2rem;">Jepang ‚úàÔ∏è Indonesia</span></h1>
        
        <div class="progress-track"><div class="progress-fill" id="progress-fill"></div></div>
        <div class="step-text" id="step-text">1/7</div>

        <form id="submissionForm">
            
            <div class="form-step active" data-step="1">
                <div class="input-group">
                    <label for="tanggalJastip" class="required">Pilih Tanggal Keberangkatan (dari Jepang)</label>
                    <select id="tanggalJastip" name="tanggalJastip" required>
                        <option value="" disabled selected>-- Pilih Tanggal --</option>
                        <option value="26 November 2025" disabled>26 November 2025 CLOSE)</option>
                        <option value="Desember 2025">Desember 2025 (tanggal menyusul)</option>
												<option value="Januari 2026">Januari 2026 (tanggal menyusul)</option>
                    </select>
                </div>
            </div>

            <div class="form-step" data-step="2">
                <h3 style="color: var(--primary);">üë§ Data Pengirim (di Jepang)</h3>
                <div class="input-group">
                    <label for="nama" class="required">Nama Pengirim</label>
                    <input type="text" id="nama" name="nama" placeholder="Contoh: Yuki Tanaka" required>
                </div>
                <div class="input-group">
                    <label for="whatsapp" class="required">Nomor WhatsApp Pengirim</label>
                    <input type="tel" id="whatsapp" name="whatsapp" placeholder="Contoh: 08012345678 atau 81012345678" required>
                    <div class="helper-text">Format: 08xxx atau 628xxx / 81xxx</div>
                </div>
            </div>

            <div class="form-step" data-step="3">
                <h3 style="color: var(--primary);">üì¨ Data Penerima (di Indonesia)</h3>
                <div class="input-group">
                    <label for="nama-penerima" class="required">Nama Penerima</label>
                    <input type="text" id="nama-penerima" name="namaPenerima" placeholder="Contoh: Budi Santoso" required>
                </div>
                <div class="input-group">
                    <label for="whatsapp-penerima" class="required">Nomor WhatsApp/Telepon Penerima</label>
                    <input type="tel" id="whatsapp-penerima" name="whatsappPenerima" placeholder="Contoh: 08123456789" required>
                </div>
                <div class="input-group">
                    <label for="alamatIndo" class="required">Alamat Lengkap di Indonesia</label>
                    <textarea id="alamatIndo" name="alamatIndo" rows="3" placeholder="Jalan, No Rumah, RT/RW, Kelurahan, Kecamatan, Kota, Provinsi" required></textarea>
                </div>
                <div class="input-group">
                    <label for="kodePosIndo" class="required">Kode Pos (5 Digit)</label>
                    <input type="text" id="kodePosIndo" name="kodePosIndo" pattern="\d{5}" placeholder="Contoh: 17111" maxlength="5" required>
                </div>
            </div>

            <div class="form-step" data-step="4">
                <h3 style="color: var(--primary);">üì¶ Detail Barang yang di Jastip</h3>
                <div class="input-group">
                    <label for="barangJastip" class="required">List Barang & Jumlah</label>
                    <textarea id="barangJastip" name="barangJastip" rows="4" placeholder="Contoh:&#10;- Tas = 1 pcs&#10;- Kosmetik = 3 pcs#10;- ..." required></textarea>
                </div>
                
                <div class="input-group">
                    <label class="required">Perlu Kami Belanjakan Terlebih Dahulu (Jastip Belanja)?</label>
                    <div class="radio-cards-container">
                        <label class="radio-card">
                            <input type="radio" id="belanjaYa" name="perluBelanja" value="Ya" required>
                            <div class="card-content">
                                <span>Ya, Tolong Belikan</span>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" id="belanjaTidak" name="perluBelanja" value="Tidak">
                            <div class="card-content">
                                <span>Tidak, Barang Sudah Ada</span>
                            </div>
                        </label>
                    </div>
                    <div class="helper-text">Pilih "Ya" jika Anda ingin kami membelikan barang di Jepang.</div>
                </div>
            </div>

            <div class="form-step" data-step="5">
                <h3 style="color: var(--primary);">üöö Pengiriman & Asuransi di Indonesia</h3>
                <div class="input-group">
                    <label for="jenisKirim" class="required">Jenis Pembayaran Ongkir</label>
                    <div class="radio-cards-container">
                        <label class="radio-card">
                            <input type="radio" name="jenisKirim" value="COD" required>
                            <div class="card-content">
                                <span>COD (Bayar di Tempat)</span>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" name="jenisKirim" value="Non COD">
                            <div class="card-content">
                                <span>Transfer (Non COD)</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <label for="asuransi" class="required">Pakai Asuransi Pengiriman?</label>
                    <div class="radio-cards-container">
                        <label class="radio-card">
                            <input type="radio" id="asuransiYa" name="asuransi" value="Ya" required>
                            <div class="card-content">
                                <span>Ya, Asuransikan</span>
                            </div>
                        </label>
                        <label class="radio-card">
                            <input type="radio" id="asuransiTidak" name="asuransi" value="Tidak">
                            <div class="card-content">
                                <span>Tidak</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="hargaBarangContainer" class="conditional-field">
                    <div class="input-group" style="background: var(--surface); padding: 15px; border-radius: 12px; border: 1px dashed var(--primary);">
                        <label for="hargaBarang" class="required">Total Nilai/Harga Barang (Yen/Rupiah)</label>
                        <input type="number" id="hargaBarang" name="hargaBarang" placeholder="Contoh: 50000" min="0">
                        <div class="helper-text">Wajib diisi untuk perhitungan klaim asuransi.</div>
                    </div>
                </div>
            </div>

            <div class="form-step" data-step="6">
                <h3 style="color: var(--primary);">‚ÑπÔ∏è Informasi Tambahan</h3>
                <div class="input-group">
                    <label for="akunSosmed" class="required">ID LINE / Instagram / TikTok</label>
                    <input type="text" id="akunSosmed" name="akunSosmed" placeholder="Contoh: LINE: @yanoshi, IG: @yanoshi" required>
                    <div class="helper-text">Untuk mempermudah komunikasi jika WhatsApp tidak bisa dihubungi.</div>
                </div>
                
                <div class="input-group">
                    <label for="kodeVoucher">Kode Voucher (Opsional)</label>
                    <input type="text" id="kodeVoucher" name="kodeVoucher" placeholder="Masukkan kode promo">
                </div>
            </div>

            <div class="form-step" data-step="7">
                <h3 style="color: var(--primary); text-align: center;">üìù Summary Data Kamu</h3>
                <p style="text-align: center; color: var(--text-light); font-size: 0.9rem;">
                    Mohon periksa kembali datamu sebelum dikirim.
                </p>
                
                <div style="background: #f8fafc; padding: 20px; border-radius: 15px; border: 1px solid #e2e8f0;" id="review-content">
                    </div>
            </div>

            <div class="nav-buttons">
                <button type="button" class="btn btn-secondary" id="prevBtn" style="visibility: hidden;">Kembali</button>
                <button type="button" class="btn btn-primary" id="nextBtn">Lanjut Langkah Berikutnya ‚Üí</button>
                <button type="submit" class="btn btn-success" id="submit-btn" style="display: none;">‚ú® Kirim Formulir</button>
            </div>

        </form>
    </div>
</main>

<div id="circular-loader-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Mengirim Data...</div>
    <div style="color: #64748b; font-size: 0.9rem; margin-top: 5px;">Mohon tunggu sebentar</div>
</div>

<div id="success-popup-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:2000; align-items:center; justify-content:center; animation: fadeInSlide 0.3s;">
    <div style="background:white; padding:2rem; border-radius:20px; text-align:center; max-width:400px; width:90%;">
        <div style="font-size:4rem; margin-bottom:1rem;">üéâ</div>
        <h2 style="color:var(--primary); margin:0;">Berhasil!</h2>
        <p style="color:#64748b;">Data jastip kamu sudah kami terima. Konfirmasi sekarang ke admin ya:</p>
        <div style="display:grid; gap:10px; margin-top:20px;">
            <a id="line-confirm-btn" href="#" target="_blank" style="background:#06c755; color:white; text-decoration:none; padding:12px; border-radius:10px; font-weight:bold;">Chat Line Admin (Rekomendasi)</a>
            <a id="whatsapp-confirm-btn" href="#" target="_blank" style="background:white; border:2px solid #25D366; color:#25D366; text-decoration:none; padding:12px; border-radius:10px; font-weight:bold;">Chat WhatsApp Admin</a>
        </div>
    </div>
</div>

<script>
    // === KONFIGURASI SCRIPT JEPANG-INDO ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyMMUJolQu2ApmEDFHhbcnuIyh34YZgH-HY5CGmoQezs2fJYJvB8WLUVoBv79RvVZDX/exec';
    
    // === LOGIKA POPUP CONSENT (SCROLL LOCK) ===
    document.addEventListener("DOMContentLoaded", function() {
        const termsBox = document.getElementById('terms-text');
        const checkBox = document.getElementById('consent-checkbox');
        const labelText = document.querySelector('#label-checkbox span');
        const agreeBtn = document.getElementById('agree-button');
        const overlay = document.getElementById('consent-overlay');
        
        // Cek LocalStorage
        const hasAgreed = localStorage.getItem('yanoshi_jp_indo_agreed');
        
        if (hasAgreed === 'true') {
            overlay.style.display = 'none';
        } else {
            document.body.style.overflow = 'hidden';
        }

        // 1. Deteksi Scroll
        termsBox.addEventListener('scroll', function() {
            if (termsBox.scrollTop + termsBox.clientHeight >= termsBox.scrollHeight - 10) {
                checkBox.disabled = false;
                labelText.style.color = 'var(--text-main)'; 
                labelText.parentElement.title = "";
            }
        });

        // 2. Deteksi Checkbox
        checkBox.addEventListener('change', function() {
            if (this.checked) {
                agreeBtn.disabled = false;
                agreeBtn.innerHTML = "Setuju & Lanjutkan üöÄ";
            } else {
                agreeBtn.disabled = true;
                agreeBtn.innerHTML = "Setuju & Lanjutkan";
            }
        });

        // 3. Tombol Setuju
        agreeBtn.addEventListener('click', function() {
            overlay.style.transition = 'opacity 0.3s ease';
            overlay.style.opacity = '0';
            localStorage.setItem('yanoshi_jp_indo_agreed', 'true');
            setTimeout(() => {
                overlay.style.display = 'none';
                document.body.style.overflow = 'auto'; 
            }, 300);
        });
    });

    // === MULTI STEP LOGIC ===
    const steps = Array.from(document.querySelectorAll('.form-step'));
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submit-btn');
    const progressFill = document.getElementById('progress-fill');
    const stepText = document.getElementById('step-text');
    const loaderOverlay = document.getElementById('circular-loader-overlay');
    let currentStep = 0;

    // === CONDITIONAL FIELD LOGIC (ASURANSI) ===
    const asuransiRadios = document.getElementsByName('asuransi');
    const hargaBarangContainer = document.getElementById('hargaBarangContainer');
    const hargaBarangInput = document.getElementById('hargaBarang');

    function checkAsuransi() {
        const selected = document.querySelector('input[name="asuransi"]:checked');
        if (selected && selected.value === 'Ya') {
            hargaBarangContainer.classList.add('show');
            hargaBarangInput.setAttribute('required', 'required');
        } else {
            hargaBarangContainer.classList.remove('show');
            hargaBarangInput.removeAttribute('required');
            // Jangan clear value agar auto-save tetap jalan, hanya hide saja
        }
    }
    
    // Attach listener to radios
    asuransiRadios.forEach(radio => radio.addEventListener('change', checkAsuransi));

    // === AUTO-SAVE SYSTEM (LOCALSTORAGE) ===
    function saveFormProgress() {
        const formData = new FormData(document.getElementById('submissionForm'));
        const formEntries = Object.fromEntries(formData);
        
        const saveData = {
            step: currentStep,
            data: formEntries,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem('yanoshi_jp_indo_draft', JSON.stringify(saveData));
    }

    function loadFormProgress() {
        const savedJson = localStorage.getItem('yanoshi_jp_indo_draft');
        if (savedJson) {
            try {
                const savedState = JSON.parse(savedJson);
                
                // Restore Inputs
                if (savedState.data) {
                    for (const [key, value] of Object.entries(savedState.data)) {
                        const input = document.querySelector(`[name="${key}"]`);
                        if (input) {
                            if (input.type === 'radio') {
                                const radio = document.querySelector(`[name="${key}"][value="${value}"]`);
                                if (radio) radio.checked = true;
                            } else {
                                input.value = value;
                            }
                        }
                    }
                }
                
                // Restore Step
                if (typeof savedState.step !== 'undefined') {
                    currentStep = savedState.step;
                }

                // Trigger logic asuransi
                checkAsuransi();
                
            } catch (e) { console.error("Error loading draft", e); }
        }
        updateUI(currentStep);
    }

    function clearStorage() {
        localStorage.removeItem('yanoshi_jp_indo_draft');
    }

    // === NAVIGATION & UI ===
    function updateUI(n) {
        steps.forEach((step, index) => step.classList.toggle('active', index === n));
        
        const progress = ((n + 1) / steps.length) * 100;
        progressFill.style.width = `${progress}%`;
        stepText.innerText = `Langkah ${n + 1} / ${steps.length}`;

        prevBtn.style.visibility = n === 0 ? 'hidden' : 'visible';
        
        if (n === steps.length - 1) { // Step 7 (Review)
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            renderReviewPage(); 
        } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function validateStep(n) {
        const currentStepEl = steps[n];
        const inputs = currentStepEl.querySelectorAll('input[required], select[required], textarea[required]');
        let isValid = true;

        inputs.forEach(input => {
            let fieldValid = true;
            
            // Check Empty
            if (input.type === 'radio') {
                const name = input.name;
                if(!currentStepEl.querySelector(`input[name="${name}"]:checked`)) fieldValid = false;
            } else {
                if (!input.value.trim()) fieldValid = false;
            }

            // Specific Regex Validation
            if (input.id === 'whatsapp' || input.id === 'whatsapp-penerima') {
                 // Hapus karakter non-digit
                 const val = input.value.replace(/[^0-9]/g, '');
                 if (!/^(08|628|8)\d{8,12}$/.test(val)) fieldValid = false;
            }
            if (input.id === 'kodePosIndo') {
                if (!/^\d{5}$/.test(input.value)) fieldValid = false;
            }

            if (!fieldValid) {
                input.style.borderColor = 'var(--error)';
                // Highlight parent for radios
                if(input.type === 'radio') {
                    const container = input.closest('.input-group');
                    if(container) container.style.border = '1px solid var(--error)';
                }
                isValid = false;
            } else {
                input.style.borderColor = '#e2e8f0';
                if(input.type === 'radio') {
                    const container = input.closest('.input-group');
                    if(container) container.style.border = 'none';
                }
            }
            
            // Remove error on input
            input.addEventListener('input', function() { 
                this.style.borderColor = '#e2e8f0'; 
            });
        });
        
        if(!isValid) {
            currentStepEl.style.animation = 'none';
            currentStepEl.offsetHeight; 
            currentStepEl.style.animation = 'shake 0.5s'; 
            alert("Mohon lengkapi data yang wajib diisi dengan benar.");
        }
        return isValid;
    }

    // Add shake animation style
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `@keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }`;
    document.head.appendChild(styleSheet);

    // === RENDER SUMMARY ===
    function renderReviewPage() {
        const container = document.getElementById('review-content');
        
        // Ambil data
        const getVal = (id) => document.getElementById(id).value;
        const getRadio = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value || '-';

        const data = {
            'Tanggal Jastip': getVal('tanggalJastip'),
            'Pengirim (Jepang)': getVal('nama'),
            'WA Pengirim': getVal('whatsapp'),
            'Penerima (Indo)': getVal('nama-penerima'),
            'WA Penerima': getVal('whatsapp-penerima'),
            'Alamat Indo': getVal('alamatIndo'),
            'Kode Pos': getVal('kodePosIndo'),
            'Barang': getVal('barangJastip'),
            'Jastip Belanja': getRadio('perluBelanja'),
            'Pembayaran': getRadio('jenisKirim'),
            'Asuransi': getRadio('asuransi'),
            'Total Harga Barang': getRadio('asuransi') === 'Ya' ? getVal('hargaBarang') : 'N/A'
        };
        
        let html = '<div class="review-list">';
        for (const [key, value] of Object.entries(data)) {
            html += `
                <div class="review-item">
                    <span class="review-label">${key}</span>
                    <span class="review-value">${value || '-'}</span>
                </div>
            `;
        }
        html += '</div>';
        container.innerHTML = html;
    }

    // === BUTTON LISTENERS ===
    nextBtn.addEventListener('click', () => {
        if (validateStep(currentStep)) {
            saveFormProgress();
            currentStep++;
            updateUI(currentStep);
        }
    });

    prevBtn.addEventListener('click', () => {
        saveFormProgress();
        currentStep--;
        updateUI(currentStep);
    });

    document.getElementById('submissionForm').addEventListener('input', () => {
        // Debounce simple save
        setTimeout(saveFormProgress, 500);
    });

    // === SUBMISSION ===
    document.getElementById('submissionForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        loaderOverlay.style.display = 'flex';
        submitBtn.disabled = true;

        try {
            // Konstruksi payload sesuai struktur Google Script JapanIndo yang asli
            const textData = {
                tanggalJastip: document.getElementById('tanggalJastip').value,
                nama: document.getElementById('nama').value,
                whatsapp: document.getElementById('whatsapp').value,
                namaPenerima: document.getElementById('nama-penerima').value,
                whatsappPenerima: document.getElementById('whatsapp-penerima').value,
                alamatIndo: document.getElementById('alamatIndo').value,
                kodePosIndo: document.getElementById('kodePosIndo').value,
                barangJastip: document.getElementById('barangJastip').value,
                perluBelanja: document.querySelector('input[name="perluBelanja"]:checked')?.value || 'Tidak',
                jenisKirim: document.querySelector('input[name="jenisKirim"]:checked')?.value || '',
                asuransi: document.querySelector('input[name="asuransi"]:checked')?.value || 'Tidak',
                hargaBarang: document.querySelector('input[name="asuransi"]:checked')?.value === 'Ya' ? document.getElementById('hargaBarang').value : '',
                kodeVoucher: document.getElementById('kodeVoucher').value,
                akunSosmed: document.getElementById('akunSosmed').value
            };

            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                redirect: "follow",
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(textData)
            });
            
            if (response.ok) {
                const result = await response.json();
                if (result.status === 'success') {
                    // SUKSES
                    loaderOverlay.style.display = 'none';
                    clearStorage();
                    
                    const name = textData.nama;
                    const tanggalHariIni = new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                    
                    const lineLink = "https://line.me/ti/p/@506hjesi";
                    const lineMsg = `Hai min, Saya ${name} sudah isi form Jastip Jepang-Indo per tanggal ${tanggalHariIni}. Mohon dicek ya, terima kasih!`;
                    
                    // Untuk WA, kita direct ke Line sesuai request asli, atau WA alternatif
                    // Di sini saya arahkan ke Line sesuai kode asli japanindo.html
                    document.getElementById('line-confirm-btn').href = lineLink;
                    // Button WA sebagai alternatif chat
                    document.getElementById('whatsapp-confirm-btn').href = `https://wa.me/628131053924?text=${encodeURIComponent(lineMsg)}`;
                    
                    document.getElementById('success-popup-overlay').style.display = 'flex';
                } else {
                    throw new Error(result.message || 'Gagal menyimpan data.');
                }
            } else {
                throw new Error("Gagal menghubungi server.");
            }

        } catch (error) {
            alert("Terjadi kesalahan: " + error.message);
            loaderOverlay.style.display = 'none';
            submitBtn.disabled = false;
        }
    });

    // === INIT ===
    window.addEventListener('load', loadFormProgress);

</script>

</body>
</html>
